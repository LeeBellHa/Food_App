{% extends "base.html" %}
{% block title %}ë¶„ì„ ê²°ê³¼ - ëƒ‰ì¥ê³ ë¥¼ ë¶€íƒí•´{% endblock %}
{% block content %}
  <h2>ğŸ” ë¶„ì„ëœ ì¬ë£Œ í™•ì¸</h2>

  <!-- 1) 4:3 í”„ë ˆì„ ì•ˆì— ì´ë¯¸ì§€ê°€ ê½‰ ì°¨ë„ë¡ -->
  <div class="preview">
    {% for fn in filenames %}
      <img src="/static/uploads/{{ fn }}" alt="ì—…ë¡œë“œ ì´ë¯¸ì§€">
    {% endfor %}
  </div>

  <!-- 2) ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ & ìˆ˜ì •/ì¶”ê°€ -->
  <form id="ingredients-form" action="/results" method="post">
    <h3>ëƒ‰ì¥ê³  ì† ì¬ë£Œ:</h3>
    <ul id="ingredient-list"></ul>

    <div style="margin:1em 0; display:flex; gap:0.5em;">
      <input
        type="text"
        id="new-ingredient"
        placeholder="+ì¬ë£Œ ì¶”ê°€í•˜ê¸°"
        style="flex:1;"
      />
      <button type="button" id="add-btn">ì¶”ê°€</button>
    </div>

    <!-- ì„œë²„ì— ë³´ë‚¼ ê°’ -->
    <input
      type="hidden"
      name="ingredients"
      id="ingredients-input"
      value="{{ ingredients|join(',') }}"
    />

    <button type="submit" style="width:100%;">í™•ì¸</button>
  </form>

  <!-- 3) JS: raw ë¬¸ìì—´ í•©ì¹˜ê³  split â†’ ê°œë³„ <li> ë Œë” -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const listEl   = document.getElementById('ingredient-list');
      const newInput = document.getElementById('new-ingredient');
      const addBtn   = document.getElementById('add-btn');
      const hiddenIn = document.getElementById('ingredients-input');

      // 1) ì„œë²„ì—ì„œ ë°›ì€ ì›ë³¸ ë°°ì—´ì„ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ í•©ì¹˜ê¸°
      let raw = {{ ingredients|tojson|safe }};
      let flat = Array.isArray(raw) ? raw.join(',') : (raw || '');

      // 2) í•˜ì´í”ˆ(-) í˜¹ì€ ì½¤ë§ˆ(,) ë¡œ ì˜ë¼ì„œ ë°°ì—´í™”
      let ingredients = flat
        .split(/[-,]/g)
        .map(s => s.trim())
        .filter(s => s.length);

      // ë¦¬ìŠ¤íŠ¸ ë Œë” í•¨ìˆ˜
      function renderList() {
        listEl.innerHTML = '';
        ingredients.forEach((item, i) => {
          const li = document.createElement('li');

          const span = document.createElement('span');
          span.textContent = item;

          const btn = document.createElement('button');
          btn.type = 'button';
          btn.textContent = 'ì‚­ì œ';
          btn.addEventListener('click', () => {
            ingredients.splice(i, 1);
            renderList();
          });

          li.appendChild(span);
          li.appendChild(btn);
          listEl.appendChild(li);
        });

        // ë³€ê²½ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ íˆë“  í•„ë“œì— ì €ì¥
        hiddenIn.value = ingredients.join(',');
      }

      // ì¶”ê°€ ë²„íŠ¼ í•¸ë“¤ëŸ¬
      addBtn.addEventListener('click', () => {
        const v = newInput.value.trim();
        if (!v) return;
        ingredients.push(v);
        newInput.value = '';
        renderList();
      });

      // ìµœì´ˆ ë Œë”
      renderList();
    });
  </script>
{% endblock %}
